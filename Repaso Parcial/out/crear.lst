     1                                  global main
     2                                  extern printf
     3                                  extern fopen
     4                                  extern fclose
     5                                  extern fwrite
     6                                  extern rewind
     7                                  
     8                                  section .data
     9 00000000 50524543494F532E44-         filename db "PRECIOS.DAT",0
     9 00000009 415400             
    10 0000000C 776200                      mode db "wb",0
    11 0000000F 4572726F7220616C20-         msgErrorOpen db "Error al abrir el archivo",0
    11 00000018 616272697220656C20-
    11 00000021 6172636869766F00   
    12                                  
    13                                      registro times 0 db ""
    14 00000029 0100                        piso dw 1
    15 0000002B 01                          departamento db 1
    16 0000002C 88130000                    precio dd 5000
    17                                  
    18                                      registro1 times 0 db ""
    19 00000030 3100                        dw '1'
    20 00000032 02                          db 2
    21 00000033 D0070000                    dd 2000
    22                                  
    23                                      registro2 times 0 db ""
    24 00000037 3200                        dw '2'
    25 00000039 01                          db 1
    26 0000003A B80B0000                    dd 3000
    27                                  
    28                                  section .bss
    29 00000000 ????????????????            fileHandle resq 1
    30                                  
    31                                  section .text
    32                                  main:
    33 00000000 48BF-                       mov rdi, filename
    33 00000002 [0000000000000000] 
    34 0000000A 48BE-                       mov rsi, mode
    34 0000000C [0C00000000000000] 
    35 00000014 4883EC08                    sub rsp,8
    36 00000018 E8(00000000)                call fopen
    37 0000001D 4883C408                    add rsp,8
    38                                  
    39 00000021 4883F800                    cmp rax,0
    40 00000025 7F19                        jg agregarRegistros
    41                                  
    42 00000027 48BF-                       mov rdi, msgErrorOpen
    42 00000029 [0F00000000000000] 
    43 00000031 4883EC08                    sub rsp,8
    44 00000035 E8(00000000)                call printf
    45 0000003A 4883C408                    add rsp,8
    46 0000003E EB46                        jmp fin
    47                                  agregarRegistros:
    48 00000040 48890425[00000000]          mov [fileHandle], rax
    49                                  
    50 00000048 48BF-                       mov rdi, registro
    50 0000004A [2900000000000000] 
    51 00000052 BE07000000                  mov rsi, 7
    52 00000057 BA01000000                  mov rdx, 1
    53 0000005C 488B0C25[00000000]          mov rcx, [fileHandle]
    54 00000064 4883EC08                    sub rsp,8
    55 00000068 E8(00000000)                call fwrite
    56 0000006D 4883C408                    add rsp,8
    57                                  
    58                                  ;    mov rdi, registro1
    59                                  ;    mov rsi, 7
    60                                  ;    mov rdx, 1
    61                                  ;    mov rcx, [fileHandle]
    62                                  ;    sub rsp,8
    63                                  ;    call fwrite
    64                                  ;    add rsp,8
    65                                  ;
    66                                  ;    mov rdi, registro2
    67                                  ;    mov rsi, 7
    68                                  ;    mov rdx, 1
    69                                  ;    mov rcx, [fileHandle]
    70                                  ;    sub rsp,8
    71                                  ;    call fwrite
    72                                  ;    add rsp,8
    73                                  eof:
    74 00000071 488B3C25[00000000]          mov rdi, [fileHandle]
    75 00000079 4883EC08                    sub rsp,8
    76 0000007D E8(00000000)                call fclose
    77 00000082 4883C408                    add rsp,8
    78                                  fin:
    79 00000086 C3                          ret
